<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="client/util/js/lib/tpl.js"></script>
    <script src="client/util/js/util.js"></script>
    <script src="client/util/js/components/grid.js"></script>
    <script src="client/util/js/components/tree.js"></script>


    <link href="client/util/css/base.css" rel="stylesheet">
    <link href="client/util/css/grid.css" rel="stylesheet">
    <link href="client/util/css/tree.css" rel="stylesheet">
</head>
<body>

<header>
    <div>oma</div>
    <nav>
        <ul>
            <li>1</li>
        </ul>
    </nav>
</header>
<aside class="left">
</aside>
<article class="right">
</article>
<footer>
</footer>
<script>

    var socket = io.connect(msj.ip);
    var role = msj.role, event = msj.et;
    var me = {
        role: role.base,
        id: Math.random() * 1989
    };
    //发送登陆事件
    socket.emit(event.login, me);
    //登陆成功回调
    socket.on(event.loginSuccess, function (o) {
        if (o.id == me.id) {
            console.log('login success');
        }
    });

    socket.on(event.addDesk, function (desk) {

        if (Object.prototype.toString.call(desk) == '[object Object]') {
            desk = [desk];
        }
        var data = [];

        for (var i = 0, len = desk.length; i < len; i++) {
            (function (index) {
                var d = desk[index];
                var o = {did: 0, order: '', price: 0};
                o.did = d.dn;
                o.statue = d.statue;
                o.id = d.id;
                var detail = d.data.list;
                for (var j = 0, l = detail.length; j < l; j++) {
                    (function (jj) {
                        o.order += detail[jj].text + ',';
                        o.price += parseInt(detail[jj].value);
                    }(j))
                }
                data.push(o);
            }(i))
        }
        grid.addData(data);
    });

    // 菜单制作完成，删除菜单
    socket.on(event.makeOver, function (data) {
        if (data.success) {
            var id = data.id;
            grid.delData(id);
        }
    })


    function num(length) {
        return  Math.pow(Math.floor(Math.random() * 100), length);
    }

    function randomData(c) {
        var datas = [];
        for (var i = 0; i < c; i++) {
            datas.push({
                cm: num(5),
                price: num(4),
                count: num(4),
                id: 'asdasd' + i,
                aa: num(4),
                bb: num(4),
                cc: num(4)
            })
        }
        return datas;
    }
    var grid = new Grid({
        parent: '.right',
        title: 'grid demo',
        fields: [
            {en: 'did', cn: '桌号'},
            {en: 'order', cn: '菜单'},
            {en: 'price', cn: '总价', sum: true},
            {en: 'statue', cn: '状态'},
            { en: 'id', cn: '', isHide: true}

        ],
        data: {list: []},
        isQuery: false,
        isToolbar: false,
        isFooter: false,
        isTitle: false,
        height: 500,
        width: 1024,
        //是否启用多选
        isMulti: false,
        page: {
            count: 16
        }
    });

    var data = [
        {
            node: 'control',
            id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d345',
            items: [
                {
                    name: 'hornbill/web/script-ss/cms/component/list',
                    text: 'list1',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d23f'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list2',
                    text: 'list2',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d231'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list3',
                    text: 'list3',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d233'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list4',
                    text: 'list4',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d222'
                }
            ]
        },
        {
            node: 'control',
            id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d345',
            items: [
                {
                    name: 'hornbill/web/script-ss/cms/component/list',
                    text: 'list1',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d23f'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list2',
                    text: 'list2',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d231'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list3',
                    text: 'list3',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d233'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list4',
                    text: 'list4',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d222'
                }
            ]
        },
        {
            node: 'control',
            id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d345',
            items: [
                {
                    name: 'hornbill/web/script-ss/cms/component/list',
                    text: 'list1',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d23f'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list2',
                    text: 'list2',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d231'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list3',
                    text: 'list3',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d233'
                },
                {
                    name: 'hornbill/web/script-ss/cms/component/list4',
                    text: 'list4',
                    id: '9f2b5353-c3d4-168f-6bc9-9c734aa0d222'
                }
            ]
        }

    ]

    window.left = new Tree({
        data: data,
        parent: '.left',
        isDrag: false,
        leafClick: function (e) {
            grid.data.list = randomData(100000);
            grid.update();
        }

    });


</script>
</body>
</html>